# Maintainer: Tomasz Jakub Rup <tomasz.rup@gmail.com>
pkgname=pnpm
pkgver=5.13.6
pkgrel=1
pkgdesc="Fast, disk space efficient package manager"
arch=('any')
url="https://pnpm.js.org/"
license=('MIT')
depends=('nodejs')
makedepends=('npm')
source=("https://registry.npmjs.org/$pkgname/-/$pkgname-$pkgver.tgz")
noextract=("$pkgname-$pkgver.tgz")
sha256sums=('37e2598f9f2ed31a72cf5d5da23ce907e40af61835e2835a61f1e2e6bab568a3')

package() {
  npm install -g --user root --prefix "$pkgdir"/usr "$srcdir/$pkgname-$pkgver.tgz"

  find "$pkgdir"/usr -type d -exec chmod 755 {} +
  chown -R root:root "$pkgdir"

  # delete source map files to reduce size
  find "$pkgdir"/usr/lib -depth -name '*.map' -delete

  install -dm755 "$pkgdir/usr/share/licenses/$pkgname"
  ln -s "../../../lib/node_modules/$pkgname/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
