# Maintainer: edward-p <edward At edward-p Dot xyz>

pkgname=proxmark3-iceman-git
pkgver=6928.555c0743
pkgrel=1
pkgdesc=pkgdesc='RRG / Iceman repo - Proxmark3 RDV4.0 and other Proxmark3 platforms.'
arch=('x86_64')
url='https://github.com/RfidResearchGroup/proxmark3'
license=('GPL2')
depends=('libusb' 'perl')
makedepends=('git' 'arm-none-eabi-gcc' 'arm-none-eabi-newlib')
provides=('proxmark3' 'proxmark3-iceman')
conflicts=('proxmark3' 'proxmark3-iceman')
options=('!makeflags')
replaces=($pkgname'-generic' $pkgname'-rdv4')
source=("$pkgname::git+https://github.com/edward-p/proxmark3.git")
sha512sums=('SKIP')
install=proxmark3-iceman-git.install

pkgver() {
  cd $pkgname
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
  cd "${srcdir}/${pkgname}"

  mkdir build  
  
  # Build firmware and recovery for pm3rdv4
  make -j DESTDIR="build" PREFIX="/usr" PLATFORM="PM3RDV4" PLATFORM_EXTRAS="BTADDON" FWTAG="rdv4" fullimage/install recovery/install

  # Build firmware and recovery for generic pm3 and other targets
  make -j DESTDIR="build" PREFIX="/usr" PLATFORM="PM3OTHER" FWTAG="other" install

}

package() {
  cd "${srcdir}/${pkgname}"
  mv build/* "${pkgdir}/"
}
