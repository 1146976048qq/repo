pkgbase=pypy-opencl4py-git
pkgname=(pypy3-opencl4py-git pypy-opencl4py-git)
pkgver=1.0.2.0.54.g1c3f25c
pkgrel=2
epoch=1
pkgdesc="Python cffi OpenCL bindings and helper classes. pypy version"
url="https://github.com/ajkxyz/opencl4py"
arch=('i686' 'x86_64')
license=('BSD')
_pypy3_deps=('pypy3>=2.4' 'pypy3<2.5')
makedepends=('git' "${_pypy3_deps[@]}" 'pypy')
source=(git://github.com/ajkxyz/opencl4py)
md5sums=('SKIP')

pkgver() {
  cd opencl4py

  git describe --tags | sed -e 's/^[^0-9]*//' -e 's/-/.0./' -e 's/-/./g'
}

build() {
  rm -rf "${srcdir}/opencl4py-python2"
  cp -a "${srcdir}/opencl4py" "${srcdir}/opencl4py-python2"
}

package_pypy3-opencl4py-git() {
  depends=("${_pypy3_deps[@]}")
  provides=('pypy3-opencl4py')
  cd opencl4py

  pypy3 setup.py install --root="$pkgdir" --optimize=1
}

package_pypy-opencl4py-git() {
  depends=('pypy')
  provides=('pypy-opencl4py')
  cd opencl4py

  pypy setup.py install --root="$pkgdir" --optimize=1
}
